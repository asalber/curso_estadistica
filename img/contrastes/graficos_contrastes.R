# Author: Alfredo Sánchez Alberca (asalber@ceu.es)

setwd("/media/alf/datos/drive/CEU/DOCENCIA/materiales/estadistica/presentaciones/manual_estadistica")
library(tikzDevice)

# Colors
blueceu <- rgb(5,161,230,255,maxColorValue = 255) #0099CC
blueceulight <- rgb(137,211,243,255,maxColorValue = 255) #89D3F3
redceu <- rgb(238,50,36,255,maxColorValue = 255) #FF3333
redceulight <- rgb(238,50,36,100,maxColorValue = 255) #FF3333
green <- rgb(0,205,0,255, maxColorValue = 255) #00CD00
greenlight <- rgb(0,205,0,100, maxColorValue = 255) #00CD00
greenceu <- rgb(194,205,255,255,maxColorValue = 255) #CCCC33
orangeceu <- rgb(248,131,121,255,maxColorValue = 255)#F88379
purpleceu <- rgb(169,78,145,255,maxColorValue = 255) #996699
greyceu <- rgb(117,117,97,255,maxColorValue = 255) #666666
grey <- gray(0.2)

options(tikzDefaultEngine = "pdftex")

# Regiones de aceptación y de rechazo de un contraste bilateral
tikz(file="img/contrastes/regiones_bilateral_normal.tex", width=4.5, height=3.3)
par(xpd=TRUE)
x = seq(-3.291, 3.291, length=100) 
y = dnorm(x, mean=0, sd=1)
par(cex.lab=1.2)
plot(x, y, type="n", main="Distribución del estadístico del contraste $\\hat\\theta$", xlab="", ylab="", bty="n", xaxt="n", yaxt="n") 
axis(side=1, c(x[21],0,x[80]), labels=c("$\\hat\\theta_{\\alpha/2}$", "$\\theta_0$", "$\\hat\\theta_{1-\\alpha/2}$"), pos=0, mgp=c(0,0.7,0))
polygon(c(x[1],x[1:21],x[21]), c(0,y[1:21],0), col=redceulight, lty=0)
polygon(c(x[80],x[80:100],x[100]), c(0,y[80:100],0), col=redceulight, lty=0) 
segments(x[21],0,x[21],y[21], col=grey)
segments(x[80],0,x[80],y[80], col=grey)
lines(x, y, type="l")
text(-2.2,0.02,"$\\alpha/2$")
text(2.2,0.02,"$\\alpha/2$")
text(0,-0.1,"Aceptacion")
text(x[21],-0.1,"Rechazo", pos=2)
text(x[80],-0.1,"Rechazo", pos=4)
segments(x[1],0,x[21],0, col=redceu, lwd=2)
segments(x[21],0,x[80],0, code=3, col=green, lwd=2)
segments(x[100],0,x[80],0, col=redceu, lwd=2)
dev.off()

# Regiones de aceptación y de rechazo de un contraste unilateral
tikz(file="img/contrastes/regiones_unilateral_mayor_normal.tex", width=4.5, height=3.3)
par(xpd=TRUE)
x = seq(-3.291, 3.291, length=100) 
y = dnorm(x, mean=0, sd=1)
par(cex.lab=1.2)
plot(x, y, type="n", main="Distribución del estadístico del contraste $\\hat\\theta$", xlab="", ylab="", bty="n", xaxt="n", yaxt="n") 
axis(side=1, c(0,x[76]), labels=c("$\\theta_0$", "$\\hat\\theta_{1-\\alpha}$"), pos=0, mgp=c(0,0.7,0))
polygon(c(x[76],x[76:100],x[100]), c(0,y[76:100],0), col=redceulight, lty=0) 
segments(x[76],0,x[76],y[76], col=grey)
lines(x, y, type="l")
text(2,0.02,"$\\alpha$")
text(0,-0.1,"Aceptacion")
text(x[76],-0.1,"Rechazo", pos=4)
segments(x[1],0,x[76],0, col=green, lwd=2)
segments(x[100],0,x[76],0, col=redceu, lwd=2)
dev.off()

# Relación entre el riesgo beta y el tamaño del efecto delta
tikz(file="img/contrastes/relacion_riesgo_beta_tamaño_efecto.tex", width=5, height=3.57)
par(xpd=FALSE)
x = seq(-3.291, 3.291, length=100) 
y = dnorm(x, mean=0, sd=1)
par(cex.lab=1, mar=c(3,1,2,1))
plot(x, y, type="n", xlim=c(-3.3,6.8), ylim=c(-0.02,0.45), main="Relación entre el riesgo $\\beta$ y el tamaño del efecto $\\delta$", xlab="$\\hat\\theta$", ylab="", xaxt="n", yaxt="n", mgp=c(2,1,.5))
abline(h=0, col="gray")
polygon(c(x[76],x[76:100],x[100]), c(0,y[76:100],0), col=redceulight, lty=0)
lines(x, y, type="l")
text(0, 0.42, "$H_0: \\theta = \\theta_0$")
segments(x[76],-0.1,x[76],y[76], col=grey)
text(2, 0.02, "$\\alpha$")
axis(side=1, 0, labels="$\\theta_0$", mgp=c(0,0.5,0))
segments(x[1],0,x[76],0, col=green, lwd=2.5)
segments(x[100]+3.46,0,x[76],0, col=redceu, lwd=2.5)
text(0,-0.02,"Aceptacion")
text(3,-0.02,"Rechazo")
polygon(c(x[1]+3,x[1:31]+3,x[31]+3), c(0,y[1:31],0), col=greenlight, lty=0)
lines(x+3, y, type="l")
segments(x[76],-0.1,x[76],y[31], col=grey)
axis(side=1, 3, labels="$\\theta_0+\\delta$", mgp=c(0,0.5,0))
text(3, 0.42, "$H_0: \\theta = \\theta_0 + \\delta$")
text(1.2,0.02, "$\\beta$")
polygon(c(x[1]+3.46,x[1:24]+3.46,x[24]+3.46), c(0,y[1:24],0), col=greenlight, lty=0)
lines(x+3.46, y, type="l")
axis(side=1, 3.46, labels="$\\theta_0+\\delta$", mgp=c(0,0.5,0))
text(3.46, 0.42, "$H_0: \\theta = \\theta_0 + \\delta$")
text(1.4,0.02, "$\\beta$")
dev.off()

# Riesgo beta para un tamaño del efecto pequeño
tikz(file="img/contrastes/riesgo_beta_tamaño_efecto_pequeño.tex", width=5, height=3.57)
par(xpd=FALSE)
x = seq(-3.291, 3.291, length=100) 
y = dnorm(x, mean=0, sd=1)
par(cex.lab=1, mar=c(3,1,2,1))
plot(x, y, type="n", xlim=c(-3.3,6.8), ylim=c(-0.02,0.45), main="Relación entre el riesgo $\\beta$ y el tamaño del efecto $\\delta$", xlab="$\\hat\\theta$", ylab="", xaxt="n", yaxt="n", mgp=c(2,1,.5))
abline(h=0, col="gray")
polygon(c(x[76],x[76:100],x[100]), c(0,y[76:100],0), col=redceulight, lty=0)
lines(x, y, type="l")
text(0, 0.42, "$H_0: \\theta = \\theta_0$")
segments(x[76],-0.10,x[76],y[76], col=grey)
text(2, 0.02, "$\\alpha$")
axis(side=1, 0, labels="$\\theta_0$", mgp=c(0,0.5,0))
segments(x[1],0,x[76],0, col=green, lwd=2.5)
segments(x[100]+3.46,0,x[76],0, col=redceu, lwd=2.5)
text(0,-0.02,"Aceptacion")
text(3,-0.02,"Rechazo")
polygon(c(x[1]+3,x[1:31]+3,x[31]+3), c(0,y[1:31],0), col=greenlight, lty=0)
lines(x+3, y, type="l")
segments(x[76],0,x[76],y[31], col=grey)
axis(side=1, 3, labels="$\\theta_0+\\delta$", mgp=c(0,0.5,0))
text(3, 0.42, "$H_0: \\theta = \\theta_0 + \\delta$")
text(1.2,0.02, "$\\beta$")
dev.off()

# Riesgo beta para un tamaño del efecto grande
tikz(file="img/contrastes/riesgo_beta_tamaño_efecto_grande.tex", width=5, height=3.57)
x = seq(-3.291, 3.291, length=100) 
y = dnorm(x, mean=0, sd=1)
par(cex.lab=1, mar=c(3,1,2,1))
plot(x, y, type="n", xlim=c(-3.3,6.8), ylim=c(-0.02,0.45), main="Relación entre el riesgo $\\beta$ y la mínima diferencia importante $\\delta$", xlab="$\\hat\\theta$", ylab="", xaxt="n", yaxt="n", mgp=c(2,1,.5))
abline(h=0, col="gray")
polygon(c(x[76],x[76:100],x[100]), c(0,y[76:100],0), col=redceulight, lty=0) 
lines(x, y, type="l")
text(0, 0.42, "$H_0: \\theta = \\theta_0$")
segments(x[76],-0.1,x[76],y[76], col=grey)
text(2, 0.02, "$\\alpha$")
axis(side=1, 0, labels="$\\theta_0$", mgp=c(0,0.5,0))
segments(x[1],0,x[76],0, col=green, lwd=2.5)
segments(x[100]+3.46,0,x[76],0, col=redceu, lwd=2.5)
text(0,-0.02,"Aceptacion")
text(3,-0.02,"Rechazo")
polygon(c(x[1]+3.46,x[1:24]+3.46,x[24]+3.46), c(0,y[1:24],0), col=greenlight, lty=0)
lines(x+3.46, y, type="l")
axis(side=1, 3.46, labels="$\\theta_0+\\delta$", mgp=c(0,0.5,0))
text(3.46, 0.42, "$H_0: \\theta = \\theta_0 + \\delta$")
text(1.4,0.02, "$\\beta$")
dev.off()

# Relación riesgo alpha y beta
tikz(file="img/contrastes/relacion_riesgos.tex", width=5, height=3.57)
x = seq(-3.291, 3.291, length=100) 
y = dnorm(x, mean=0, sd=1)
par(cex.lab=1, mar=c(3,1,2,1))
plot(x, y, type="n", xlim=c(-3.3,6.8), ylim=c(-0.02,0.45), main="Relación entre los riesgos $\\alpha$ y $\\beta$", xlab="$\\hat\\theta$", ylab="", xaxt="n", yaxt="n", mgp=c(2,1,.5))
abline(h=0, col="gray")
polygon(c(x[72],x[72:100],x[100]), c(0,y[72:100],0), col=redceulight, lty=0)
segments(x[72],-0.1,x[72],y[72], col=grey)
text(2, 0.02, "$\\alpha$")
polygon(c(x[80],x[80:100],x[100]), c(0,y[80:100],0), col=redceulight, lty=0)
lines(x, y, type="l")
text(0, 0.42, "$H_0: \\theta = \\theta_0$")
axis(side=1, 0, labels="$\\theta_0$", mgp=c(0,0.5,0))
segments(x[1],0,x[72],0, col=green, lwd=2)
segments(x[100]+3,0,x[72],0, col=redceu, lwd=2)
text(0,-0.02,"Aceptacion")
text(3,-0.02,"Rechazo")
polygon(c(x[1]+3,x[1:27]+3,x[27]+3), c(0,y[1:27],0), col=greenlight, lty=0)
segments(x[72],0,x[72],y[72], col=grey)
text(1.2,0.02, "$\\beta$")
polygon(c(x[1]+3,x[1:35]+3,x[35]+3), c(0,y[1:35],0), col=greenlight, lty=0)
segments(x[80],-0.1,x[80],y[35], col=grey)
text(2.2, 0.02, "$\\alpha$")
segments(x[1],0,x[80],0, col=green, lwd=2)
segments(x[100]+3,0,x[80],0, col=redceu, lwd=2)
lines(x+3, y, type="l")
axis(side=1, 3, labels="$\\theta_0+\\delta$", mgp=c(0,0.5,0))
text(3, 0.42, "$H_0: \\theta = \\theta_0 + \\delta$")
dev.off()


# Relación riesgo alpha y beta
tikz(file="img/contrastes/relacion_riesgos_alfa_grande.tex", width=5, height=3.57)
x = seq(-3.291, 3.291, length=100) 
y = dnorm(x, mean=0, sd=1)
par(cex.lab=1, mar=c(3,1,2,1))
plot(x, y, type="n", xlim=c(-3.3,6.8), ylim=c(-0.02,0.45), main="Relación entre los riesgos $\\alpha$ y $\\beta$", xlab="$\\hat\\theta$", ylab="", xaxt="n", yaxt="n", mgp=c(2,1,.5))
abline(h=0, col="gray")
polygon(c(x[72],x[72:100],x[100]), c(0,y[72:100],0), col=redceulight, lty=0)
segments(x[72],-0.1,x[72],y[72], col=grey)
text(2, 0.02, "$\\alpha$")
lines(x, y, type="l")
text(0, 0.42, "$H_0: \\theta = \\theta_0$")
axis(side=1, 0, labels="$\\theta_0$", mgp=c(0,0.5,0))
segments(x[1],0,x[72],0, col=green, lwd=2.5)
segments(x[100]+3,0,x[72],0, col=redceu, lwd=2.5)
text(0,-0.02,"Aceptacion")
text(3,-0.02,"Rechazo")
polygon(c(x[1]+3,x[1:27]+3,x[27]+3), c(0,y[1:27],0), col=greenlight, lty=0)
segments(x[72],0,x[72],y[72], col=grey)
text(1.2,0.02, "$\\beta$")
lines(x+3, y, type="l")
axis(side=1, 3, labels="$\\theta_0+\\delta$", mgp=c(0,0.5,0))
text(3, 0.42, "$H_0: \\theta = \\theta_0 + \\delta$")
dev.off()


# Relación riesgo alpha y beta
tikz(file="img/contrastes/relacion_riesgos_alfa_pequeño.tex", width=5, height=3.57)
x = seq(-3.291, 3.291, length=100) 
y = dnorm(x, mean=0, sd=1)
par(cex.lab=1, mar=c(3,1,2,1))
plot(x, y, type="n", xlim=c(-3.3,6.8), ylim=c(-0.02,0.45), main="Relación entre los riesgos $\\alpha$ y $\\beta$", xlab="$\\hat\\theta$", ylab="", xaxt="n", yaxt="n", mgp=c(2,1,.5))
abline(h=0, col="gray")
polygon(c(x[80],x[80:100],x[100]), c(0,y[80:100],0), col=redceulight, lty=0)
lines(x, y, type="l")
text(0, 0.42, "$H_0: \\theta = \\theta_0$")
axis(side=1, 0, labels="$\\theta_0$", mgp=c(0,0.5,0))
text(0,-0.02,"Aceptacion")
text(3,-0.02,"Rechazo")
text(1.2,0.02, "$\\beta$")
polygon(c(x[1]+3,x[1:35]+3,x[35]+3), c(0,y[1:35],0), col=greenlight, lty=0)
segments(x[80],-0.1,x[80],y[35], col=grey)
text(2.2, 0.02, "$\\alpha$")
segments(x[1],0,x[80],0, col=green, lwd=2.5)
segments(x[100]+3,0,x[80],0, col=redceu, lwd=2.5)
lines(x+3, y, type="l")
axis(side=1, 3, labels="$\\theta_0+\\delta$", mgp=c(0,0.5,0))
text(3, 0.42, "$H_0: \\theta = \\theta_0 + \\delta$")
dev.off()


# Relación entres los riesgos alfa y beta y el tamaño muestral
tikz(file="img/contrastes/relacion_riesgos_tamaño_muestral.tex", width=5, height=3.57)
x = seq(-3.291, 3.291, length=100)
y = dnorm(x, mean=0, sd=1)
par(cex.lab=1, mar=c(3,1,2,1))
plot(x, y, type="n", xlim=c(-3.3,6.3), ylim=c(-0.02,0.52), main="Riesgos de error para muestras pequeñas", xlab="$\\hat\\theta$", ylab="", xaxt="n", yaxt="n", mgp=c(2,1,.5))
abline(h=0, col="gray")
polygon(c(x[73],x[73:100],x[100]), c(0,y[73:100],0), col=redceulight, lty=0)
segments(x[73],-0.1,x[73],y[73], col=grey)
text(2, 0.02, "$\\alpha$")
lines(x, y, type="l")
text(0, 0.52, "$H_0: \\theta = \\theta_0$")
axis(side=1, 0, labels="$\\theta_0$", mgp=c(0,0.5,0))
segments(x[1],0,x[73],0, col=green, lwd=2.5)
segments(x[100]+3,0,x[73],0, col=redceu, lwd=2.5)
text(0,-0.02,"Aceptacion")
text(3,-0.02,"Rechazo")
polygon(c(x[1]+3,x[1:28]+3,x[28]+3), c(0,y[1:28],0), col=greenlight, lty=0)
text(1.1,0.02, "$\\beta$")
lines(x+3, y, type="l")
axis(side=1, 3, labels="$\\theta_0+\\delta$", mgp=c(0,0.5,0))
text(3, 0.52, "$H_0: \\theta = \\theta_0 + \\delta$")
y = dnorm(x, mean=0, sd=0.8)
polygon(c(x[73],x[73:100],x[100]), c(0,y[73:100],0), col=redceulight, lty=0)
segments(x[73],-0.1,x[73],y[73], col=grey)
text(1.8, 0.02, "$\\alpha$")
lines(x, y, type="l")
polygon(c(x[1]+3,x[1:28]+3,x[28]+3), c(0,y[1:28],0), col=greenlight, lty=0)
text(1.3,0.02, "$\\beta$")
lines(x+3, y, type="l")
dev.off()


# Riesgos tamaño muestral pequeño
tikz(file="img/contrastes/relacion_riesgos_tamaño_muestral_pequeño.tex", width=5, height=3.57)
x = seq(-3.291, 3.291, length=100)
y = dnorm(x, mean=0, sd=1)
par(cex.lab=1, mar=c(3,1,2,1))
plot(x, y, type="n", xlim=c(-3.3,6.3), ylim=c(-0.02,0.52), main="Riesgos de error para muestras pequeñas", xlab="$\\hat\\theta$", ylab="", xaxt="n", yaxt="n", mgp=c(2,1,.5))
abline(h=0, col="gray")
polygon(c(x[73],x[73:100],x[100]), c(0,y[73:100],0), col=redceulight, lty=0)
segments(x[73],-0.1,x[73],y[73], col=grey)
text(2, 0.02, "$\\alpha$")
lines(x, y, type="l")
text(0, 0.52, "$H_0: \\theta = \\theta_0$")
axis(side=1, 0, labels="$\\theta_0$", mgp=c(0,0.5,0))
segments(x[1],0,x[73],0, col=green, lwd=2.5)
segments(x[100]+3,0,x[73],0, col=redceu, lwd=2.5)
text(0,-0.02,"Aceptacion")
text(3,-0.02,"Rechazo")
polygon(c(x[1]+3,x[1:28]+3,x[28]+3), c(0,y[1:28],0), col=greenlight, lty=0)
text(1.1,0.02, "$\\beta$")
lines(x+3, y, type="l")
axis(side=1, 3, labels="$\\theta_0+\\delta$", mgp=c(0,0.5,0))
text(3, 0.52, "$H_0: \\theta = \\theta_0 + \\delta$")
dev.off()


# Riesgos tamaño muestral grande
tikz(file="img/contrastes/relacion_riesgos_tamaño_muestral_grande.tex", width=5, height=3.57)
x = seq(-3.291, 3.291, length=100)
y = dnorm(x, mean=0, sd=0.8)
par(cex.lab=1, mar=c(3,1,2,1))
plot(x, y, type="n", xlim=c(-3.3,6.3), ylim=c(-0.02,0.52), main="Riesgos de error para muestras grandes", xlab="$\\hat\\theta$", ylab="", xaxt="n", yaxt="n", mgp=c(2,1,.5))
abline(h=0, col="gray")
polygon(c(x[73],x[73:100],x[100]), c(0,y[73:100],0), col=redceulight, lty=0)
segments(x[73],-0.1,x[73],y[73], col=grey)
text(1.8, 0.02, "$\\alpha$")
lines(x, y, type="l")
text(0, 0.52, "$H_0: \\theta = \\theta_0$")
axis(side=1, 0, labels="$\\theta_0$", mgp=c(0,0.5,0))
segments(x[1],0,x[73],0, col=green, lwd=2.5)
segments(x[100]+3,0,x[73],0, col=redceu, lwd=2.5)
text(0,-0.02,"Aceptacion")
text(3,-0.02,"Rechazo")
polygon(c(x[1]+3,x[1:28]+3,x[28]+3), c(0,y[1:28],0), col=greenlight, lty=0)
text(1.3,0.02, "$\\beta$")
lines(x+3, y, type="l")
axis(side=1, 3, labels="$\\theta_0+\\delta$", mgp=c(0,0.5,0))
text(3, 0.52, "$H_0: \\theta = \\theta_0 + \\delta$")
dev.off()


#Curva de potencia
tikz(file="img/contrastes/potencia.tex", width=5, height=3.57)
x = seq(0,1, length=100)
y = pbinom(1, size=10, prob=x[1:100])
z = pbinom(41, size=100, prob=x[1:100])
par(cex.lab=1, mar=c(3,3,3,1))
plot(x, y, type="l", xlab="Proporción verdadera", ylab="Potencia", main="Curvas de potencia para $\\alpha = 0.05$", col=blueceu, yaxs="i", mgp=c(2,0.5,0))
lines(x, z, type="l", col=redceu)
legend(0.8, 1, lty=1, col=c(blueceu, redceu), legend=expression(n==10,n==100), bty="n") 
dev.off()


